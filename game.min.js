const planetsCount=4;var highScore,loadState={preload:function(){game.load.image("background","assets/background.png"),game.load.image("player","assets/player.png"),game.load.image("engine","assets/engine.png"),game.load.image("bullet","assets/bullet.png"),game.load.image("asteroid","assets/asteroid.png"),game.load.spritesheet("planets","assets/planets.png",500,500,planetsCount),(highScore=window.localStorage.getItem("highScore"))||(highScore=0)},create:function(){game.state.start("menu")}},menuState={create:function(){this.background=game.add.sprite(0,0,"background"),this.gameTitleText=game.add.text(game.world.centerX,.7*game.world.centerY,"AROUND",{fill:"#FFF",font:"bold 58px Arial"}),this.gameTitleText.anchor.setTo(.5),this.playText=game.add.text(game.world.centerX,1.5*game.world.centerY,"Press [SPACEBAR] to start!",{fill:"#FFF"}),this.playText.anchor.setTo(.5),this.playText.alpha=0,this.tween=game.add.tween(this.playText).to({alpha:1},1e3,"Linear",!0,0,-1),this.tween.yoyo(!0,2e3),this.playKey=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.playKey.onDown.add(this.startGame,this)},startGame:function(){game.state.start("play")}};const innerOrbitOffset=0,outerOrbitOffset=75;var planet,orbit;function createPlanet(){(planet=game.add.sprite(game.world.centerX,game.world.centerY,"planets")).anchor.setTo(.5,.5),(orbit=game.add.graphics()).anchor.setTo(.5,.5),drawOrbit()}function generatePlanet(){let e=Math.floor(Math.random()*(planetsCount+1)),t=Math.floor(361*Math.random()-180),a=11316396*Math.random()+5460819,r=0,o=.005*(r=current.level<=50?Math.floor(Math.random()*(2*current.level+50)+200):Math.floor(151*Math.random()+200));planet.frame=e,planet.angle=t,planet.tint=a,planet.height=r,planet.width=r,planet.gravity=o,drawOrbit()}function drawOrbit(){orbit.clear(),orbit.lineStyle(2,16777215,.1),orbit.drawCircle(planet.x,planet.y,planet.width+110+outerOrbitOffset),orbit.drawCircle(planet.x,planet.y,planet.width+15+playerSize+innerOrbitOffset)}const playerSize=20;var player;function createPlayer(){player=game.add.sprite(game.world.centerX-playerSize/2,(game.height-planet.height)/2-playerSize,"player"),game.physics.enable(player,Phaser.Physics.ARCADE),player.width=playerSize,player.height=playerSize,player.anchor.setTo(.5,.5),player.addChild(game.make.sprite(-125,-240,"engine")),player.speed=1,player.currentAngle=-90,player.maneuverForce=3.25,player.orbitOffset=outerOrbitOffset/2,player.orbitDirection=0,player.weapon=game.add.weapon(1,"bullet"),player.weapon.bulletKillType=Phaser.Weapon.KILL_WORLD_BOUNDS,player.weapon.trackSprite(player,0,15),player.weapon.bulletSpeed=400}function movePlayer(){0!=player.orbitDirection&&(player.orbitOffset>=innerOrbitOffset&&player.orbitOffset<=outerOrbitOffset&&(player.orbitOffset+=player.orbitDirection>0?player.orbitDirection-planet.gravity:player.orbitDirection+planet.gravity),player.orbitOffset<0&&(player.orbitOffset=0,player.orbitDirection=0),player.orbitOffset>75&&(player.orbitOffset=75,player.orbitDirection=0)),player.currentAngle=Phaser.Math.wrapAngle(player.currentAngle+player.speed);let e=Phaser.Math.degToRad(player.currentAngle),t=(planet.width+15+playerSize)/2+player.orbitOffset;player.x=planet.x+t*Math.cos(e),player.y=planet.y+t*Math.sin(e),player.angle=player.currentAngle}const spawnCount=12;var asteroids;function createAsteroids(){for(let e=0;e<spawnCount;e++){let e=game.add.sprite(game.world.centerX,game.world.centerY,"asteroid");e.anchor.setTo(.5,.5),e.kill(),asteroids.add(e)}asteroids.count=4,asteroids.nextPosition=0}function generateAsteroids(){current.level%3==0&&asteroids.count<spawnCount&&asteroids.count++;let e=-70,t=generatePositions(),a=0,r=[];for(let o=0;o<16;o++)if(o%2==0&&(e=Phaser.Math.wrapAngle(e+40)),t[a]==o){let t=asteroids.getChildAt(a),o=Math.floor(3*Math.random()-1),i=Phaser.Math.degToRad(e+o),n=Math.floor(11*Math.random()+15),l=(planet.width+15+n)/2,s=Math.floor(Math.random()*(outerOrbitOffset+1));if(r.push([e,s,e+o]),a>0&&e==r[a-1][0]){let e=r[a-1][1],t=Math.abs(e-s);t<n&&(s=e+n),e<15&&s>outerOrbitOffset-15&&(s=outerOrbitOffset),s<15&&e>outerOrbitOffset-15&&(s=innerOrbitOffset),e>20&&e<outerOrbitOffset-20&&t<n&&(s=e+n/2)}let d=l+s,c=planet.x+d*Math.cos(i),h=planet.y+d*Math.sin(i),p=Math.floor(361*Math.random()-180),g=1579032*Math.random()+10395294;t.x=c,t.y=h,t.height=n,t.width=n,t.angle=p,t.tint=g,t.revive(),a++}asteroids.positionArr=r.map(function(e){return e[2]})}function generatePositions(){let e=[];if(asteroids.count<9)for(let t=0;t<8;t++)e[t]=2*t;else for(let t=0;t<16;t++)e[t]=t;let t,a=e.length,r=0;for(;a--;)r=Math.floor(Math.random()*(a+1)),t=e[a],e[a]=e[r],e[r]=t;return(e=e.slice(0,asteroids.count)).sort((e,t)=>e-t),e}var current={level:1,score:0,ammo:1},playState={create:function(){this.background=game.add.sprite(0,0,"background"),this.physics.startSystem(Phaser.Physics.ARCADE),createPlanet(),generatePlanet(),createPlayer(),asteroids=game.add.physicsGroup(),createAsteroids(),generateAsteroids(),this.levelLabel=game.add.text(.2*game.world.centerX,1.75*game.world.centerY,"LEVEL",{fill:"#fff",font:"18px Arial"}),this.levelLabel.anchor.setTo(.5),this.levelText=game.add.text(.2*game.world.centerX,1.85*game.world.centerY,"999",{fill:"#fff",font:"bold 26px Arial"}),this.levelText.anchor.setTo(.5),this.scoreLabel=game.add.text(1.8*game.world.centerX,1.75*game.world.centerY,"SCORE",{fill:"#fff",font:"18px Arial"}),this.scoreLabel.anchor.setTo(.5),this.scoreText=game.add.text(1.8*game.world.centerX,1.85*game.world.centerY,"999999",{fill:"#fff",font:"bold 26px Arial"}),this.scoreText.anchor.setTo(.5),this.plusKey=game.input.keyboard.addKey(Phaser.Keyboard.UP),this.plusKey.onDown.add(this.incOrbit,this),this.minusKey=game.input.keyboard.addKey(Phaser.Keyboard.DOWN),this.minusKey.onDown.add(this.decOrbit,this),this.fireKey=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.fireKey.onDown.add(this.fire,this)},update:function(){movePlayer(),game.physics.arcade.overlap(player,asteroids,this.playerHit),game.physics.arcade.overlap(player.weapon.bullets,asteroids,this.asteroidHit);let e=asteroids.positionArr[asteroids.nextPosition];e-1<player.angle&&e+1>player.angle&&(current.score+=current.level,asteroids.nextPosition++,asteroids.nextPosition==asteroids.positionArr.length?asteroids.nextPosition=0:e==asteroids.positionArr[asteroids.nextPosition]&&(current.score+=current.level,asteroids.nextPosition++)),-91==player.angle&&(current.level++,current.ammo=1,generatePlanet(),generateAsteroids()),this.levelText.setText(current.level),this.scoreText.setText(current.score)},incOrbit:function(){player.orbitDirection=player.maneuverForce},decOrbit:function(){player.orbitDirection=-player.maneuverForce},fire:function(){current.ammo>0&&(player.weapon.fireAngle=player.angle+90,player.weapon.fire(),current.ammo--)},playerHit:function(){game.state.start("lose")},asteroidHit:function(e,t){current.score+=current.level,t.kill()}},loseState={create:function(){this.background=game.add.sprite(0,0,"background"),this.gameOverText=game.add.text(game.world.centerX,.5*game.world.centerY,"Game Over!",{fill:"#FFF",font:"bold 48px Arial"}),this.gameOverText.anchor.setTo(.5),this.scoreText=game.add.text(game.world.centerX,.8*game.world.centerY,"Score",{fill:"#FFF",font:"24px Arial"}),this.scoreText.anchor.setTo(.5),this.lastScoreText=game.add.text(.8*game.world.centerX,game.world.centerY,"LAST:",{fill:"#FFF",font:"22px Arial"}),this.lastScoreText.anchor.setTo(.5),this.lastScore=game.add.text(1.1*game.world.centerX,game.world.centerY,"999999",{fill:"#FFF",font:"bold 28px Arial"}),this.lastScore.anchor.setTo(.5),this.highScoreText=game.add.text(.8*game.world.centerX,1.2*game.world.centerY,"HIGH:",{fill:"#FFF",font:"22px Arial"}),this.highScoreText.anchor.setTo(.5),this.highScore=game.add.text(1.1*game.world.centerX,1.2*game.world.centerY,"999999",{fill:"#FFF",font:"bold 28px Arial"}),this.highScore.anchor.setTo(.5),this.gameScore(),this.replayText=game.add.text(game.world.centerX,1.5*game.world.centerY,"Press [SPACEBAR] to restart!",{fill:"#FFF",font:"bold 26px Arial"}),this.replayText.anchor.setTo(.5),this.replayText.alpha=0,this.tween=game.add.tween(this.replayText).to({alpha:1},1e3,"Linear",!0,0,-1),this.tween.yoyo(!0,2e3),this.replayKey=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.replayKey.onDown.add(this.restartGame,this)},restartGame:function(){current.level=1,current.score=0,current.ammo=1,game.state.start("play")},gameScore:function(){current.score>highScore&&(highScore=current.score,window.localStorage.setItem("highScore",highScore),this.scoreText.setText("NEW RECORD!"),this.scoreText.addColor("#ffd700",0),this.highScore.addColor("#ffd700",0)),this.lastScore.setText(current.score),this.highScore.setText(highScore)}},gameConfig={width:600,height:600,renderer:Phaser.CANVAS,parent:"game"},game=new Phaser.Game(gameConfig);game.state.add("load",loadState),game.state.add("menu",menuState),game.state.add("play",playState),game.state.add("lose",loseState),game.state.start("load");